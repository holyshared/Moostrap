(function(){var a=this.Bootstrap=function(d){var i,h,k,f;var e=["resource","configurations","onStart","onProgress","onComplete","onSuccess","onFailure"];i=(d.strategy)?d.strategy:"async";k=i.capitalize();if(!a.Strategy[k]){throw new Error(k+" is not found")}h=a.Strategy[k];if(!d.module){throw new Error("module is not found")}f=d.module.getContainer();var g=Object.subset(d,e);var j=Object.merge({strategy:h,bootstrappers:f},g);var l=new h(j);l.init();return l};a.Module=new Class({initialize:function(){this._collection=new a.Bootstrappers()},register:function(e,d){var f=new a.Bootstrapper(d);this._collection.addItem(e,f)},unregister:function(d){this._collection.removeItem(d)},isRegistered:function(d){return this._collection.hasItem(d)},getContainer:function(){return this._collection},setContainer:function(d){if(!Type.isBootstrappers()){throw new TypeError("invalid container")}this._collection=d}});a.Strategy={};a.NONE=0;a.SUCCESS=1;a.FAILURE=2;a.Bootstrapper=new Class({_status:null,_started:false,initialize:function(e){var g={resource:null,options:null,handler:null};var h=Object.merge(g,e);for(var f in h){var d="_"+f;if(h[f]){this[d]=h[f]}delete h[f]}},success:function(){this._setResultStatus(a.SUCCESS);this.fireEvent("complete");this.fireEvent("success")},failure:function(){this._setResultStatus(a.FAILURE);this.fireEvent("complete");this.fireEvent("failure")},getResource:function(){return this._resource},getOptions:function(){return this._options},_setResultStatus:function(e){var d=[a.NONE,a.SUCCESS,a.FAILURE];if(!d.contains(e)){throw new TypeError("invalid status")}this._status=e},getResultStatus:function(){return this._status},isSuccessed:function(){return(this.getResultStatus()==a.SUCCESS)?true:false},isFailured:function(){return(this.getResultStatus()==a.FAILURE)?true:false},isCompleted:function(){return(this.getResultStatus()!=a.NONE)?true:false},isStarted:function(){return this._started}});var c=new Type("Bootstrapper",a.Bootstrapper);c.mirror(function(e){var d={};d[e]=function(){var g=arguments;var f=this.getItems();var h=[];Object.each(f,function(k,j){var i=k[e].apply(k,g);if((typeOf(i)!="bootstrapper")){h.push(i)}});return(h.length>0)?h:this};a.Bootstrappers.implement(d)});a.Bootstrappers=new Class({_cursor:0,_keys:[],_bootstrappers:{},getLength:function(){return this._keys.length},getKeys:function(){return this._keys},getItem:function(d){if(!this.hasItem(d)){throw new Error("not found key")}return this._bootstrappers[d]},getItems:function(){var e={};var d=(arguments.length>0)?Array.from(arguments):this._keys;d.each(function(g,f){e[g]=this.getItem(g)},this);return e},hasItem:function(d){return this._keys.contains(d)},addItem:function(e,d){if(!Type.isBootstrapper(d)){throw new TypeError("invalid bootstrap.")}this._keys.push(e);this._bootstrappers[e]=d;return this},addItems:function(d){if(!Type.isObject(d)){throw new TypeError("invalid bootstrappers.")}Object.each(d,function(f,e){this.addItem(e,f)},this);return this},removeItem:function(d){if(!this.hasItem(d)){throw new Error("not found key")}this._keys.erase(d);delete this._bootstrappers[d];return this},removeItems:function(){var d=(arguments.length>0)?Array.from(arguments):this._keys;d.each(function(f,e){this.removeItem(f)},this);return this},hasNext:function(){var d=this._keys.length-1;return(d>=this._cursor+1)?true:false},next:function(){if(!this.hasNext()){return}var d=this._keys[++this._cursor];return this._bootstrappers[d]},current:function(){var d=this._keys[this._cursor];return this._bootstrappers[d]},rewind:function(){this._cursor=0},each:function(e,f){var d=[this._bootstrappers].append(Array.from(arguments));Object.each.apply(Object,d)}});var b=new Type("Bootstrappers",a.Bootstrappers);a.Bootstrapper.implement({setResource:function(d){if(!Type.isObject(d)){throw new TypeError("invalid resurce")}this._resource=d;return this},setOptions:function(d){if(!Type.isObject(d)){throw new TypeError("invalid resurce")}this._options=Object.merge(this._options||{},d);return this},execute:function(){this._started=true;this.fireEvent("start");this._handler.call(this,this.getResource(),this.getOptions())}});a.Bootstrapper.implement(new Events())}());(function(a){a.Executer=new Class({Implements:[Events,Options],_counter:0,_bootstrappers:null,_configurations:null,_started:false,_status:Bootstrap.NONE,initialize:function(b){var d;for(var c in b){d="set"+c.capitalize();if(this[d]){this[d].call(this,b[c]);delete b[c]}}this.setOptions(b)},setBootstrappers:function(b){if(!Type.isBootstrappers(b)){throw new TypeError("invalid bootstrappers")}this._bootstrappers=b;return this},getBootstrappers:function(){return this._bootstrappers},setResource:function(b){this.resource=b;return this},getResource:function(){return this.resource},setConfigurations:function(b){this.configurations=b;return this},getConfigurations:function(){return this.configurations},getConfiguration:function(b){return this.configurations[b]},getBootstrapper:function(c){var b=this.getBootstrappers();return b.getItem(c)},getBootstrapperKeys:function(){var b=this.getBootstrappers();return b.getKeys()},getLength:function(){var b=this.getBootstrappers();return b.getLength()},_setResultStatus:function(c){var b=[Bootstrap.NONE,Bootstrap.SUCCESS,Bootstrap.FAILURE];if(!b.contains(c)){throw new TypeError("invalid status")}this._status=c},getResultStatus:function(){return this._status},isStarted:function(){return this._started},isSuccessed:function(){return(this.getResultStatus()==Bootstrap.SUCCESS)?true:false},isFailured:function(){return(this.getResultStatus()==Bootstrap.FAILURE)?true:false},isCompleted:function(){return(this.getResultStatus()!=Bootstrap.NONE)?true:false},_progress:function(c){var b=[c,this._counter+1,this.getLength()];this.fireEvent("progress",b);if(this._counter++>=this.getLength()-1){if(this.isFailured()){return}this._setResultStatus(Bootstrap.SUCCESS);this.fireEvent("complete");this.fireEvent("success");return}},execute:function(b){if(this.isCompleted()){return}if(!this.isStarted()){this._started=true}if(b){this.setResource(b);this.getBootstrappers().setResource(b)}this.fireEvent("start");this.bootstrap()},bootstrap:function(){},onFailure:function(b){this._setResultStatus(Bootstrap.FAILURE);this.fireEvent("complete");this.fireEvent("failure")}})}(Bootstrap.Strategy));(function(a){a.Async=new Class({Extends:a.Executer,init:function(){var b=this.getBootstrappers();if(this.getResource()){b.setResource(this.getResource())}b.each(function(d,c){this._setupBootstrapper(c,d)},this)},bootstrap:function(){var b=this.getBootstrappers();b.each(function(d,c){if(this.isCompleted()){return}d.execute()},this)},_setupBootstrapper:function(e,f){var c=[e];var d={success:this.onSuccess.bind(this,c),failure:this.onFailure.bind(this,c)};var b=this.getConfiguration(e)||{};f.setOptions(b).addEvents(d)},onSuccess:function(b){this._progress(b)}})}(Bootstrap.Strategy));